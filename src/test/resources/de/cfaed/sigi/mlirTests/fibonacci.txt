module {
    // fib_naive: int -> int
    func.func @fib_naive(%e0: !sigi.stack) -> !sigi.stack {
        %e1, %1 = sigi.pop %e0: i32 // n
        %e2 = sigi.push %e1, %1: i32 // n
        %2 = arith.constant 1: i32
        %e3 = sigi.push %e2, %2: i32
        %e4, %3 = sigi.pop %e3: i32
        %e5, %4 = sigi.pop %e4: i32
        %5 = arith.cmpi "sle", %3, %4: i32
        %e6 = sigi.push %e5, %5: i1
        %6 = closure.box (%e7 : !sigi.stack) -> !sigi.stack { // -> int
            %7 = arith.constant 1: i32
            %e8 = sigi.push %e7, %7: i32
            closure.return %e8: !sigi.stack
        }
        %e9 = sigi.push %e6, %6: !closure.box<!sigi.stack -> !sigi.stack>
        %8 = closure.box (%e10 : !sigi.stack) -> !sigi.stack { // -> int
            %e11 = sigi.push %e10, %1: i32 // n
            %9 = arith.constant 2: i32
            %e12 = sigi.push %e11, %9: i32
            %e13, %10 = sigi.pop %e12: i32
            %e14, %11 = sigi.pop %e13: i32
            %12 = arith.subi %10, %11: i32
            %e15 = sigi.push %e14, %12: i32
            %e16 = func.call @fib_naive(%e15) : !sigi.stack -> !sigi.stack
            %e17 = sigi.push %e16, %1: i32 // n
            %13 = arith.constant 1: i32
            %e18 = sigi.push %e17, %13: i32
            %e19, %14 = sigi.pop %e18: i32
            %e20, %15 = sigi.pop %e19: i32
            %16 = arith.subi %14, %15: i32
            %e21 = sigi.push %e20, %16: i32
            %e22 = func.call @fib_naive(%e21) : !sigi.stack -> !sigi.stack
            %e23, %17 = sigi.pop %e22: i32
            %e24, %18 = sigi.pop %e23: i32
            %19 = arith.addi %17, %18: i32
            %e25 = sigi.push %e24, %19: i32
            closure.return %e25: !sigi.stack
        }
        %e26 = sigi.push %e9, %8: !closure.box<!sigi.stack -> !sigi.stack>
        %e27 = func.call @":if:"(%e26) : !sigi.stack -> !sigi.stack
        return %e27: !sigi.stack
    }
    // fib_tailrec: int -> int
    func.func @fib_tailrec(%e0: !sigi.stack) -> !sigi.stack {
        %1 = arith.constant 1: i32
        %e1 = sigi.push %e0, %1: i32
        %2 = arith.constant 1: i32
        %e2 = sigi.push %e1, %2: i32
        %e3 = func.call @fib_tailrec_helper(%e2) : !sigi.stack -> !sigi.stack
        return %e3: !sigi.stack
    }
    // fib_tailrec_helper: int, int, int -> int
    func.func @fib_tailrec_helper(%e0: !sigi.stack) -> !sigi.stack {
        %e1, %1 = sigi.pop %e0: i32 // n
        %e2, %2 = sigi.pop %e1: i32 // a
        %e3, %3 = sigi.pop %e2: i32 // b
        %e4 = sigi.push %e3, %1: i32 // n
        %4 = arith.constant 0: i32
        %e5 = sigi.push %e4, %4: i32
        %e6, %5 = sigi.pop %e5: i32
        %e7, %6 = sigi.pop %e6: i32
        %7 = arith.cmpi "eq", %5, %6: i32
        %e8 = sigi.push %e7, %7: i1
        %8 = closure.box (%e9 : !sigi.stack) -> !sigi.stack { // -> int
            %e10 = sigi.push %e9, %2: i32 // a
            closure.return %e10: !sigi.stack
        }
        %e11 = sigi.push %e8, %8: !closure.box<!sigi.stack -> !sigi.stack>
        %9 = closure.box (%e12 : !sigi.stack) -> !sigi.stack { // -> int
            %e13 = sigi.push %e12, %1: i32 // n
            %10 = arith.constant 1: i32
            %e14 = sigi.push %e13, %10: i32
            %e15, %11 = sigi.pop %e14: i32
            %e16, %12 = sigi.pop %e15: i32
            %13 = arith.cmpi "eq", %11, %12: i32
            %e17 = sigi.push %e16, %13: i1
            %14 = closure.box (%e18 : !sigi.stack) -> !sigi.stack { // -> int
                %e19 = sigi.push %e18, %3: i32 // b
                closure.return %e19: !sigi.stack
            }
            %e20 = sigi.push %e17, %14: !closure.box<!sigi.stack -> !sigi.stack>
            %15 = closure.box (%e21 : !sigi.stack) -> !sigi.stack { // -> int
                %e22 = sigi.push %e21, %1: i32 // n
                %16 = arith.constant 1: i32
                %e23 = sigi.push %e22, %16: i32
                %e24, %17 = sigi.pop %e23: i32
                %e25, %18 = sigi.pop %e24: i32
                %19 = arith.subi %17, %18: i32
                %e26 = sigi.push %e25, %19: i32
                %e27 = sigi.push %e26, %3: i32 // b
                %e28 = sigi.push %e27, %2: i32 // a
                %e29 = sigi.push %e28, %3: i32 // b
                %e30, %20 = sigi.pop %e29: i32
                %e31, %21 = sigi.pop %e30: i32
                %22 = arith.addi %20, %21: i32
                %e32 = sigi.push %e31, %22: i32
                %e33 = func.call @fib_tailrec_helper(%e32) : !sigi.stack -> !sigi.stack
                closure.return %e33: !sigi.stack
            }
            %e34 = sigi.push %e20, %15: !closure.box<!sigi.stack -> !sigi.stack>
            %e35 = func.call @":if:"(%e34) : !sigi.stack -> !sigi.stack
            closure.return %e35: !sigi.stack
        }
        %e36 = sigi.push %e11, %9: !closure.box<!sigi.stack -> !sigi.stack>
        %e37 = func.call @":if:"(%e36) : !sigi.stack -> !sigi.stack
        return %e37: !sigi.stack
    }
    // __main__: ->
    func.func @__main__(%e0: !sigi.stack) -> !sigi.stack {
        %1 = arith.constant 20: i32
        %e1 = sigi.push %e0, %1: i32
        %e2 = func.call @fib_tailrec(%e1) : !sigi.stack -> !sigi.stack
        %2 = arith.constant 20: i32
        %e3 = sigi.push %e2, %2: i32
        %e4 = func.call @fib_naive(%e3) : !sigi.stack -> !sigi.stack
        %e5, %3 = sigi.pop %e4: i32
        %e6, %4 = sigi.pop %e5: i32
        %5 = arith.cmpi "eq", %3, %4: i32
        %e7 = sigi.push %e6, %5: i1
        %e8 = func.call @show(%e7) : !sigi.stack -> !sigi.stack
        return %e8: !sigi.stack
    }
}